sudo: required
dist: trusty
addons:
  chrome: stable
branches:
  only:
    - master
    - dev
    - lva-37
notifications:
  email:
    on_success: always
    on_failure: always
  slack:
    secure: Rw4A1EOomJpWvwtlfvJg2pOtTjspKY+KS7eNGC0GISnolax1DJ0MIHugRvWfQ3bIDECK/+/p3uxFeMYB/6gNJ6294mnr68XaVxgbqtk8OHi4fMBkAX0Csb+tUM6/Wg+DVKdaOll6Qhz8qaWJWlpGJHVFYojfaKy8cv/xqqnmNASJlsZVZvocVxJPlH3YZr/Tu9MDpTmUJcyIgXdpCGvBHTqIowpaA6QVsTVN5aZU+zJ1lz+w7LXMp2KbcFSFlT23IoJXV4uR78SmVFktxNl8NQYG4Aow1gV1Uwsb8aYIK2nXUZIiy16AtFWi+oGG2X4yxFW0yf0zhrmEcUMwHvwiE9bO1RWzF+nfFA3wpT+tQywJOHo/qjIgMpJVBO2emvXrn6oyS5lq3oWfwni7ye3Bxs8iM4rs6Bmvm6rXo04jHG+il+NDVk6L0Qi95OsVILNSaPoPt7vG2keImPuMbUJUC4+x3S38IY9WjdQtAb1bgl8/cgQ5Cw7T6DJzqcDIu0/8rvbdO8+/zcU41IN/8W3c7Ib+sMiCxsQLMzdo6pvx5cr2RtZq1tfjRxx5UXodeiAX6fXe9vHXSA67GggnM8f/5G23VPG4E2Ud0SN+pjj77o6qFaKu0zrEZl8WabMDDOiFy+6FkzZfjGtiKW8G7dex7Zyf0UiwtE4JZMsQNvgCe44=
    on_success: always
    on_failure: always
language: php
php:
  - 7.1
before_install:
 - # start your web application and listen on `localhost`
   - google-chrome-stable --headless --disable-gpu --remote-debugging-port=9222 http://localhost &
install:
  - nvm install v8.1.2
before_script:
  - phpenv config-rm xdebug.ini
  - cp env.travis .env
  - composer install --no-progress --no-suggest --no-interaction --optimize-autoloader
  - php artisan key:generate
  - npm install
  - npm rebuild node-sass
  - npm run production
  - touch database/database.sqlite
  - php artisan migrate

script:
  - vendor/bin/phpunit

  - php artisan serve --host localhost --port 80 > /dev/null 2>&1 &
  - sleep 3
  - php artisan dusk